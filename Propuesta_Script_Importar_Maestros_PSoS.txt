## Script: Importar Maestros (Wrapper PSoS)
## Propósito: Ejecutar la importación en el servidor para compatibilidad WebDirect.
## Explicación: 
## En WebDirect, el paso "Importar registros" busca el archivo en la computadora del usuario (navegador).
## Al usar "Ejecutar guión en el servidor" (PSoS), el script se ejecuta dentro del servidor,
## donde sí tiene acceso directo al archivo "Agenda Profesores Rec Musica.fmp12".

# 1. Detectar si ya estamos en el servidor
If [ PatternCount ( Get ( ApplicationVersion ) ; "Server" ) > 0 ]
    # --- ESTA PARTE SE EJECUTA EN EL SERVIDOR ---
    
    # 1.1 Ir a la presentación y limpiar (Tu lógica original)
    Ir a la presentación [ "Maestros" (Maestros) ]
    Mostrar todos los registros
    Eliminar todos los registros [ Con diálogo: Inactivo ]
    
    # 1.2 Importar
    # IMPORTANTE: Asegúrate de que "Agenda Profesores..." está en la misma carpeta del servidor.
    Importar registros [ Con diálogo: Inactivo ; Tabla: Maestros ; "file:Agenda Profesores Rec Musica.fmp12" ; Añadir; Mac Roman ]
    # Si la fuente es otro archivo hospedado, mejor usar Fuente de Datos Externa (fmnet:/...)
    
    # 1.3 Filtrar Activos (Tu lógica original)
    Modo Buscar [ Pausa: Desactivado ]
    Establecer campo [ Maestros::Activo Inactivo ; "Activo" ]
    Ejecutar búsqueda []
    
    Salir del guión [ Resultado: 1 ]

Else
    # --- ESTA PARTE SE EJECUTA EN EL CLIENTE (WebDirect / Pro) ---
    
    # 2. Mandar a ejecutar al servidor
    #    "Esperar a que termine: Activo" es importante para ver los nuevos datos.
    Ejecutar guión en el servidor [ Especificado: De la lista ; "Importar maestros" ; Esperar a que termine: Activo ]
    
    # 3. Manejo de errores
    If [ Get ( LastError ) = 812 ] 
        # Error 812: Capacidad del anfitrión excedida (o PSoS no soportado en local)
        # Fallback: Intentar localmente si es FileMaker Pro, o mostrar error en WebDirect.
        If [ Get ( SystemPlatform ) = 4 ]
            Mostrar cuadro de diálogo personalizado [ "Error" ; "No se pudo conectar con el motor de scripts del servidor." ]
        Else
            # Ejecutar localmente (llamada recursiva o pasos directos)
            # Nota: Esto solo servirá en Pro si tiene acceso al archivo.
            Ejecutar guión [ "Importar maestros (Logica Local)" ]
        End If
    End If
    
    # 4. Refrescar para ver los cambios hechos por el servidor
    Refrescar ventana [ Vaciar resultados de memoria caché adjuntos ]
    
End If
